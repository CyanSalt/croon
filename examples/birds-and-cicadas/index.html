<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>CroonJS</title>
</head>
<body>
  <button id="play">Play!</button>
  <script type="module">
    import { play } from 'https://unpkg.com/croonjs'
    let controller
    const scores = [
      `
1=bB 4/4 !76
0_ 3_ 5_ 3+_ 2+_ 1+_ 7_ 1+_ | ^1+_ 5_ ^5 - - | 0_ 3_ 5_ 3+_ 2+_ 1+_ 7_ 1+_ | ^1+_ 7_ ^7 - - |
0_ 6_ 1+_ 6+_ 5+_ 4+_ 3+_ 4+_ | 3+ 5+ 1+ - | 0_ 6_ 1+_ 4+_ 3+_ 2+_ 2+ | 1+_ 5_ ^5 - - |
0_ 3_ 5_ 3+_ 2+_ 1+_ 7_ 1+_ | ^1+_ 5_ ^5 - - | 0_ 3_ 5_ 3+_ 2+_ 1+_ 7_ 1+_ | ^1+_ 7_ ^7 - - |
0_ 6_ 1+_ 6+_ 5+_ 4+_ 3+_ 4+_ | 3+ 5+ 1+ - | 0_ 6_ 1+_ 4+_ 4+_ 3+_ 4+_ 5+_ | ^5+_ 5+_ ^5+ - - |
5+ 0 5+_ 5+_ 5+_ 5+_ | 5+ 1+ 5_ 5+_ 5+_ 4+_ | 4+ 3+ 3+_ 7+_ 7+_ 3+_ | 7+ 1++ 1++_ 3+_ 3+_ 1+_ |
6+ 7+ 5+_ 6+_ 6+_ 5+_ | 5+_ 6+_ 6+_ 5+_ 5+_ 7+_ 7+ | 5+_ 2++_ 2++_ 3+_ 3+_ 1++_ 1++ | 0_ 4+_ 4+_ 3+_ 4+_ 5+_ 6+_ 6+_ |
^6+_ 5+_ ^5+ 5+_ 5+_ 5+_ 5+_ | 5+ 1+ 5_ 5+_ 5+_ 4+_ | 4+ 3+ 3+_ 7+_ 7+_ 3+_ | 2++ 1++ 1++_ 3+_ 3+_ 1+_ |
6+ 7+ 5+_ 6+_ 6+_ 5+_ | 5+_ 6+_ 6+_ 5+_ 5+_ 7+_ 7+ | 5+_ 2++_ 2++_ 3+_ 3+_ 1++_ 1++ |
0_ 4+_ 4+_ 3+_ 4+_ 5+_ 6+ | 5+ - - - ||
      `,
      `
1=bB 4/4 !76
1-_ 5-_ 1_ 5-_ 2_ 5-_  3 | 7--_ 5-_ 7-_ 5-_ 2 - | 6--_ 3-_ 6-_ 3-_ 7-_ 3-_ 1 | 5--_ 3-_ 5-_ 3-_ 7- #6- |
4--_ 1-_ 4- 5--_ 2-_ 5- | 3--_ 7--_ 3- 6--_ 3-_ 6- | 2--_ 6--_ 1-_ 6--_ 4- - | 7- - 5- - |
1-_ 5-_ 1_ 5-_ 2_ 5-_  3 | 7--_ 5-_ 7-_ 5-_ 2 7- | 6--_ 3-_ 6-_ 3-_ 7-_ 3-_ 1 | 5--_ 3-_ 5-_ 3-_ 7- #6- |
4--_ 1-_ 4- 5--_ 2-_ 5- | 3--_ 7--_ 3- 6--_ 3-_ 6- | 2--_ 6--_ 1-_ 6--_ 4-_ 6--_ 1- | 5--_ 2-_ 5-_ 7-_ 2_ 5_ 7_ 2+_ |
2- - - - | 1-_ 5-_ 3_ 5-_ 2_ 5-_ 3_ 5-_ | 7--_ 5-_ 2-_ 5-_ 7-_ 5-_ 2_ 5-_ | 6--_ 3-_ 1_ 3-_ 7-_ 3-_ 1_ 3-_ |
5--_ 3-_ 7-_ 3-_ 5-_ 3-_ 7-_ 3-_ | 4--_ 1-_ 6-_ 1-_ 5--_ 2-_ 7- | 3--_ 7--_ #5-_ 7--_ 6--_ 3-_ 1 | 2--_ 6--_ 4-_ 6--_ 6-_ 6--_ 4-_ 6--_ |
5--_ 2-_ 7-_ 2-_ 2_ 2-_ 7- | 1-_ 5-_ 3_ 5-_ 2_ 5-_ 3_ 5-_ | 7--_ 5-_ 2_ 5-_ 7-_ 5-_ 2_ 5-_ | 6--_ 3-_ 1_ 3-_ 7-_ 3-_ 1_ 3-_ |
5--_ 3-_ 7-_ 3-_ 5-_ 3-_ 7-_ 3-_ | 4--_ 1-_ 6-_ 1-_ 5--_ 2-_ 7- | 3--_ 7--_ #5-_ 7--_ 6--_ 3-_ 6-_ 5-_ |
4- - - - | 5- - - - ||
      `,
    ]
    async function loop() {
      controller = new AbortController()
      const context = new AudioContext()
      await Promise.all(
        scores.map(score => play(score, {
          context,
          signal: controller.signal,
          gain: 0.2,
          simulation: 'keyboard',
        }))
      )
      return loop()
    }
    document.getElementById('play').addEventListener('click', () => {
      if (controller) {
        controller.abort()
        controller = undefined
      } else {
        loop().catch(() => {})
      }
    })
  </script>
</body>
</html>
